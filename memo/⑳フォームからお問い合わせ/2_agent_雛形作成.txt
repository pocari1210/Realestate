




◆モデルの編集◆

ディレクトリ
\routes\web.php

・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・

class PropertyMessage extends Model
{
  use HasFactory;

  protected $guarded = [];

  ↓↓追記↓↓
  public function property()
  {
    return $this->belongsTo(Property::class, 'property_id', 'id');
  }

  public function user()
  {
    return $this->belongsTo(User::class, 'user_id', 'id');
  }
  ↑↑追記↑↑

★コード解説★
PropertyモデルとUserモデルをリレーションしている


/////////////////////////////////////////////////////////////////////////////////////////////////

◆ルートの編集◆

ディレクトリ
\routes\web.php

・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・

// ★agent権限でログインした場合のルートグループ2★
Route::middleware(['auth', 'role:agent'])->group(function () {

  // Agent All Property  
  Route::controller(AgentPropertyController::class)->group(function () {

    // Agent:メッセージのルート
    Route::get('/agent/property/message/', 'AgentPropertyMessage')
      ->name('agent.property.message');


/////////////////////////////////////////////////////////////////////////////////////////////////

◆ビューの編集(遷移元)◆

ディレクトリ
\resources\views\agent\body\sidebar.blade.php

・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・

<li class="nav-item">
            <a href="../../pages/apps/chat.html" class="nav-link">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-message-square link-icon"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>
              <span class="link-title">Chat</span>
            </a>
          </li>

/////////////////////////////////////////////////////////////////////////////////////////////////

◆コントローラーの編集◆

ディレクトリ
\app\Http\Controllers\Agent\AgentPropertyController.php

・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・

use App\Models\PropertyMessage;

  public function AgentPropertyMessage()
  {
    $id = Auth::user()->id;
    $usermsg = PropertyMessage::where('agent_id', $id)->get();

    return view(
      'agent.message.all_message',
      compact('usermsg')
    );
  } // End Method 

/////////////////////////////////////////////////////////////////////////////////////////////////

◆ビューの編集(遷移先)◆

ディレクトリ
\resources\views\agent\body\sidebar.blade.php

・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・

画面が疎通できていたらOK
